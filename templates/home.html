{% extends "base.html" %}
{% block content %}

<!-- Splash Overlay -->
<div id="splash" class="splash">
  <h1 class="neon-text big-title splash-text">BuzzTube</h1>
</div>

<!-- Main Content -->
<div id="main-content" style="display:none;">
  <div class="container">
    <h1 class="neon-text big-title">BuzzTube Home</h1>

    <!-- Video Feed -->
    <ul class="video-list">
      {% for v in videos %}
        <li class="card three-d-card">
          <!-- Video Title -->
          <h2 class="neon-text three-d-text">{{ v['title'] }}</h2>
          <p class="meta">Uploaded by {{ v['uploader'] }}</p>

          <!-- Video Preview -->
          {% if v['filepath'] %}
            <div class="three-d-video">
              <video controls width="100%" preload="metadata">
                <source src="{{ v['filepath'] }}" type="video/mp4">
                Your browser does not support the video tag.
              </video>
            </div>
          {% else %}
            <p class="flash warning">No video file available.</p>
          {% endif %}

          <!-- Actions -->
          <div class="actions three-d-actions">
            <form action="{{ url_for('like_video', id=v['id']) }}" method="POST">
              <button type="submit" class="btn three-d-btn">Like ({{ v['likes'] }})</button>
            </form>
            <form action="{{ url_for('follow_user', username=v['uploader']) }}" method="POST">
              <button type="submit" class="btn three-d-btn">Follow {{ v['uploader'] }}</button>
            </form>
            <a class="btn three-d-btn" href="{{ url_for('video', id=v['id']) }}">Watch</a>
          </div>

          <!-- Comment Box -->
          <form action="{{ url_for('video', id=v['id']) }}" method="POST" class="neon-form-inline">
            <div class="neon-field">
              <label class="neon-label" for="c-{{ v['id'] }}">Comment</label>
              <input id="c-{{ v['id'] }}" type="text" name="text" placeholder="Write a commentâ€¦" class="neon-input">
            </div>
            <button type="submit" class="btn three-d-btn">Post</button>
          </form>
        </li>
      {% else %}
        <li class="meta">No videos found. Upload one to get started!</li>
      {% endfor %}
    </ul>
  </div>
</div>

<!-- Styles -->
<style>
  /* Splash */
  .splash {
    position:fixed; inset:0;
    background:#000; display:flex;
    justify-content:center; align-items:center;
    z-index:9999;
  }
  .splash-text {
    animation: pulseScale 2s infinite;
    text-shadow: 0 0 20px #ff33aa, 0 0 40px #ff66cc, 0 0 60px #ff99dd;
  }
  @keyframes pulseScale {
    0% { transform: scale(1); }
    25% { transform: scale(1.2); }
    50% { transform: scale(0.9); }
    75% { transform: scale(1.3); }
    100% { transform: scale(1); }
  }

  /* Cards */
  .three-d-card {
    background:#1a1a1a; border-radius:12px; padding:16px; margin-bottom:20px;
    box-shadow: 0 0 20px #ff33aa;
    transform: perspective(1000px) rotateX(5deg) rotateY(-3deg);
    transition: transform .35s ease, box-shadow .35s ease;
  }
  .three-d-card:hover {
    transform: perspective(1000px) rotateX(0deg) rotateY(0deg) scale(1.04);
    box-shadow: 0 0 40px #ff66cc;
  }

  .three-d-text { text-shadow: 0 0 14px #ff33aa, 0 0 28px #ff66cc; }

  /* Video */
  .three-d-video video {
    border-radius:12px; box-shadow: 0 0 30px #ff33aa;
    transform: rotateY(-5deg) translateZ(18px);
    transition: transform .35s ease, box-shadow .35s ease;
  }
  .three-d-video video:hover {
    transform: rotateY(0deg) translateZ(28px) scale(1.03);
    box-shadow: 0 0 50px #ff66cc;
  }

  /* Buttons */
  .three-d-btn {
    background:#ff33aa; color:#fff; border:none; padding:10px 18px; border-radius:10px; font-weight:700;
    box-shadow: 0 0 20px #ff33aa; transform: translateZ(12px);
    transition: transform .25s ease, box-shadow .25s ease, background .25s ease, color .25s ease;
    margin-right:10px;
  }
  .three-d-btn:hover {
    transform: translateZ(26px) scale(1.08);
    box-shadow: 0 0 40px #ff66cc;
    background:#ff66cc; color:#000;
  }

  /* Neon Text Boxes */
  .neon-form-inline {
    display:flex; gap:12px; align-items:flex-end; margin-top:16px; flex-wrap:wrap;
  }
  .neon-field { flex:1; display:flex; flex-direction:column; gap:8px; }

  .neon-label {
    color:#ff66cc; font-weight:700; letter-spacing:.02em;
    text-shadow: 0 0 6px #ff33aa;
  }

  .neon-input {
    width:100%;
    padding:12px 16px;
    border:1px solid rgba(255,102,204,0.35);
    border-radius:12px;
    background:#0a0a0a;
    color:#ff66cc;
    font-size:1rem;
    font-weight:600;
    outline:none;
    box-shadow:
      inset 0 0 10px rgba(255,51,170,0.35),
      inset 0 0 18px rgba(255,102,204,0.25),
      0 0 10px rgba(255,51,170,0.35);
    transform: perspective(800px) translateZ(8px);
    transition: border-color .25s ease, box-shadow .25s ease, transform .25s ease, background .25s ease;
  }

  .neon-input::placeholder {
    color:#ff99dd;
    text-shadow: 0 0 6px #ff33aa;
    font-style:italic;
    opacity:.9;
  }

  .neon-input:hover {
    border-color: rgba(255,102,204,0.6);
    box-shadow:
      inset 0 0 14px rgba(255,102,204,0.35),
      inset 0 0 24px rgba(255,51,170,0.28),
      0 0 16px rgba(255,102,204,0.5);
    transform: perspective(800px) translateZ(14px);
  }

  .neon-input:focus {
    background: linear-gradient(160deg, #0a0a0a 0%, #151515 100%);
    border-color:#ff66cc;
    box-shadow:
      inset 0 0 18px rgba(255,102,204,0.55),
      inset 0 0 28px rgba(255,51,170,0.4),
      0 0 22px rgba(255,102,204,0.8),
      0 0 38px rgba(255,51,170,0.45);
    transform: perspective(800px) translateZ(20px) scale(1.03);
  }
</style>

<!-- Script -->
<script>
  function showSplash(callback) {
    const splash = document.getElementById("splash");
    const main = document.getElementById("main-content");
    splash.style.display = "flex";
    splash.style.opacity = 1;
    main.style.display = "none";
    setTimeout(() => {
      splash.style.opacity = 0;
      splash.style.transition = "opacity 1.2s ease";
      setTimeout(() => {
        splash.style.display = "none";
        main.style.display = "block";
        if (callback) callback();
      }, 1200);
    }, 1800
