{% extends "base.html" %}
{% block content %}

<div class="container">
  <h1 class="neon-text big-title">BuzzTub Home</h1>

  <!-- Ads for non-premium users -->
  {% if premium == 0 %}
  <div id="ad-banner" class="card flash" style="margin:20px auto; text-align:center; border:2px solid #ff00cc; box-shadow:0 0 15px #ff00cc;">
    <h3 class="neon-text">Sponsored</h3>
    <p>Upgrade to Premium to remove ads!</p>
    <!-- Ad media (image or video) -->
    <img src="{{ url_for('static', filename='ads/ad1.png') }}" alt="Ad" style="max-width:100%; border-radius:8px;">
    <!-- Skip Ad Button -->
    <button id="skip-ad" class="btn" style="margin-top:10px; background:#ff00cc; color:#fff; border:none; padding:8px 16px; border-radius:6px; box-shadow:0 0 10px #ff00cc;">
      Skip Ad
    </button>
  </div>
  <script>
    // Auto-hide ad after 10 seconds
    setTimeout(function() {
      const ad = document.getElementById("ad-banner");
      if (ad) ad.style.display = "none";
    }, 10000);

    // Manual skip button
    document.getElementById("skip-ad").addEventListener("click", function() {
      const ad = document.getElementById("ad-banner");
      if (ad) ad.style.display = "none";
    });
  </script>
  {% endif %}

  <!-- Video Feed -->
  <ul class="video-list">
    {% for v in videos %}
      <li class="card">
        <!-- Video Title -->
        <h2 class="neon-text">{{ v['title'] }}</h2>
        <p class="meta">Uploaded by {{ v['uploader'] }}</p>

        <!-- Video Preview -->
        {% if v['filepath'] %}
          <video controls width="100%" style="border-radius:12px; box-shadow:0 0 20px #6600ff;" preload="metadata">
            <source src="{{ v['filepath'] }}" type="video/mp4">
            Your browser does not support the video tag.
          </video>
        {% else %}
          <p class="flash warning">No video file available.</p>
        {% endif %}

        <!-- Actions -->
        <div class="actions" style="margin-top:12px;">
          <!-- Like Button -->
          <form action="{{ url_for('like_video', id=v['id']) }}" method="POST" style="display:inline;">
            <button type="submit" class="btn">üëç Like ({{ v['likes'] }})</button>
          </form>

          <!-- Follow Button -->
          <form action="{{ url_for('follow_user', username=v['uploader']) }}" method="POST" style="display:inline;">
            <button type="submit" class="btn">‚ûï Follow {{ v['uploader'] }}</button>
          </form>

          <!-- Watch Button -->
          <a class="btn" href="{{ url_for('video', id=v['id']) }}">‚ñ∂Ô∏è Watch</a>
        </div>
      </li>
    {% else %}
      <li class="meta">No videos found. Upload one to get started!</li>
    {% endfor %}
  </ul>
</div>

{% endblock %}
